<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.12.0"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Transfer Matrices: Tutorial</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="clipboard.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  extensions: ["tex2jax.js"],
  jax: ["input/TeX","output/HTML-CSS"],
});
</script>
<script type="text/javascript" async="async" src="https://cdn.jsdelivr.net/npm/mathjax@2/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="doxygen-awesome.css" rel="stylesheet" type="text/css"/>
<link href="doxygen-awesome-sidebar-only.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">Transfer Matrices<span id="projectnumber">&#160;0.0.0DEV</span>
   </div>
   <div id="projectbrief">C++ library for transfer matrix computations</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.12.0 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() { codefold.init(0); });
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search',true);
  $(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function(){initNavTree('tutorial.html',''); initResizable(true); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">Tutorial</div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="md_src_2tutorial"></a></p>
<p>The library provides some convenient template classes to cover common needs in transfer matrix computations. This page describes, via an example, how the library is intended to be used.</p>
<p>The goal is to define the action of a transfer matrix</p>
<p>$$T = \prod_i R_i $$</p>
<p>on some chosen basis \(\{|e_i \rangle\}\).</p>
<h1><a class="anchor" id="autotoc_md3"></a>
Data types</h1>
<p>The snippets of code from this section come from the <a class="el" href="examples.html">examples/ising</a> section <a href="../examples/ising/ising.hpp">ising.hpp</a> and <a href="../examples/ising/ising.cpp">ising.cpp</a> files, which define</p>
<h2><a class="anchor" id="autotoc_md4"></a>
Built-in key types</h2>
<p>Usually, we represent basis states as a sequence of numbers. An easy example is the Ising model, for which a link state can be represented as a sequence of +1 and -1's. The library provides two types for representing sequences of numbers:</p>
<ul>
<li><a class="el" href="classkey__int8__t.html">key_int8_t</a></li>
<li><a class="el" href="classkey__64__bit__t.html">key_64_bit_t</a></li>
</ul>
<p>It is a good practice to define your own key type inheriting from these; in the snippet below for instance we create a <code>Key</code> class which is a sequence of 3-bits numbers of length <code>SIZE</code>, stored in a 64-bit integer. We also define a <code>shift_right</code> method that cyclically permutes the entries of this key:</p>
<div class="fragment"><div class="line"><span class="preprocessor">#define bits_per_site 3</span></div>
<div class="line"><span class="keyword">class </span>Key : <span class="keyword">public</span> <a class="code hl_class" href="classkey__64__bit__t.html">key_64_bit_t</a>&lt;bits_per_site&gt; {</div>
<div class="line"><span class="keyword">public</span>:</div>
<div class="line"><span class="keyword">using </span><a class="code hl_class" href="classkey__64__bit__t.html">key_64_bit_t</a>&lt;bits_per_site&gt;<a class="code hl_class" href="classkey__64__bit__t.html">::key_64_bit_t</a>;</div>
<div class="line"><span class="comment">// we must specify how our keys should be printed</span></div>
<div class="line">  <span class="keywordtype">void</span> print ()<span class="keyword"> const </span>{ <a class="code hl_class" href="classkey__64__bit__t.html">key_64_bit_t&lt;bits_per_site&gt;::print</a> (SIZE); }</div>
<div class="line">  <span class="keywordtype">void</span> shift_right () {</div>
<div class="line">    <span class="keywordtype">int</span> last = (*this)[SIZE-1];</div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = SIZE-2; i &gt;= 0; i--) {</div>
<div class="line">      set (i + 1, (*<span class="keyword">this</span>)[i]);</div>
<div class="line">    }</div>
<div class="line">    set (0, last);</div>
<div class="line">  }</div>
<div class="line">};</div>
</div><!-- fragment --><p>We can access elements, set their values and print the key:</p>
<div class="fragment"><div class="line"><span class="keywordtype">void</span> test_key() {</div>
<div class="line">Key k ({1, 0, 1, 0});</div>
<div class="line">k.print (); <span class="comment">// output: (  1, 0, 1, 0  ) </span></div>
<div class="line">printf (<span class="stringliteral">&quot;k[2] = %d\n&quot;</span>, k[2]); <span class="comment">// output: 1</span></div>
<div class="line"> k.set (4, 1); <span class="comment">// set key[4] to 1.</span></div>
<div class="line">}</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md5"></a>
Defining a basis</h2>
<p>After defining a key type, we need to define a type for representing basis vectors, and operations on basis vectors. For this purpose, the class <a class="el" href="class_basis_vector.html">BasisVector&lt;K, V&gt;</a> holds a <code>(key, value)</code> pair. A good practice is to derive from this class in order to define a particular basis of a space of states:</p>
<div class="fragment"><div class="line"><span class="keyword">using </span>Weight = double;</div>
<div class="line"><span class="keyword">class </span>IsingPM : <span class="keyword">public</span> <a class="code hl_class" href="class_basis_vector.html">BasisVector</a>&lt;Key, Weight&gt; {</div>
<div class="line"><span class="keyword">public</span>:</div>
<div class="line"><span class="keyword">using </span><a class="code hl_class" href="class_basis_vector.html">BasisVector</a>&lt;Key, Weight&gt;<a class="code hl_class" href="class_basis_vector.html">::BasisVector</a>;  <span class="comment">// use the base constructors</span></div>
<div class="line">IsingPM (Key k, Weight v) : <a class="code hl_class" href="class_basis_vector.html">BasisVector</a>&lt;Key, Weight&gt; (k, v) {}</div>
<div class="line">IsingPM (Key k) : <a class="code hl_class" href="class_basis_vector.html">BasisVector</a>&lt;Key, Weight&gt; (k, Weight (1)) {}</div>
<div class="line"><span class="comment">// ...</span></div>
</div><!-- fragment --><p>In this example, we create a class <code>IsingPM</code> for representing basis states. We can define methods to operate on these states:</p>
<div class="fragment"><div class="line"><span class="comment">// in class IsingPM {</span></div>
<div class="line"><span class="keyword">public</span>:</div>
<div class="line"><span class="keywordtype">void</span> add_vertical_edge(IsingState&amp; v, <span class="keywordtype">int</span> pos);</div>
<div class="line"><span class="keywordtype">void</span> add_horizontal_edge(IsingState&amp; v, <span class="keywordtype">int</span> pos1, <span class="keywordtype">int</span> pos2);</div>
<div class="line"><span class="keywordtype">void</span> r_matrix(IsingState&amp; v, <span class="keywordtype">int</span> pos);</div>
<div class="line">}; <span class="comment">// end of class IsingPM</span></div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md6"></a>
Vectors</h2>
<p>To represent a general vector, which is a sum of basis vectors, the library exposes a class <a class="el" href="class_vector.html">Vector&lt;BasisVector&gt;</a> which stores several <code>(key, value)</code> pairs in a hash table (or dictionary), using the hash table implementation of the C++ standard library <code>std::unordered_map</code>. This data structure allows for fast insertion, lookup, and deletion.</p>
<p>Like for <code><a class="el" href="class_basis_vector.html">BasisVector</a></code>s, it is a good practice to inherit from the <code><a class="el" href="class_vector.html">Vector</a></code> class:</p>
<div class="fragment"><div class="line"> </div>
<div class="line"><span class="keyword">class </span>IsingState : <span class="keyword">public</span> <a class="code hl_class" href="class_vector.html">Vector</a>&lt;IsingPM, Hash&gt; {</div>
<div class="line"><span class="keyword">public</span>:</div>
<div class="line">  <span class="keyword">using </span><a class="code hl_class" href="class_vector.html">Vector</a>&lt;IsingPM, Hash&gt;<a class="code hl_function" href="class_vector.html#a0faa99acaf54dafcf479d15b16b3b522">::Vector</a>; <span class="comment">// inherit base constructors</span></div>
<div class="line">  <span class="keyword">using </span><a class="code hl_class" href="class_vector.html">Vector</a>&lt;IsingPM, Hash&gt;::operator+=;</div>
<div class="line">  <span class="keywordtype">void</span> <a class="code hl_function" href="class_vector.html#a8fe7c81eb0e3c128bb455e3b1730a06e">print</a> ()<span class="keyword"> const </span>{ <a class="code hl_function" href="class_vector.html#a8fe7c81eb0e3c128bb455e3b1730a06e">Vector&lt;IsingPM, Hash&gt;::print</a> (); }</div>
</div><!-- fragment --><p> This again gives some flexibility to add methods and data to the state.</p>
<p>One can multiply a vector by a scalar, add a basis vector to a vector, or add vectors together. Vectors can be looped through, or looped through and drained at the same time, which is useful to limit memory usage. To prevent overflowing of vector components, one can factorize the norm of the vector. The norm of the vector is stored as an arbitrary precision number, which cannot overflow.</p>
<div class="fragment"><div class="line"><span class="keywordtype">void</span> test_vector() {</div>
<div class="line">  IsingState v = IsingState(10); <span class="comment">// initialises a vector with a hash table with 10 slots</span></div>
<div class="line">  v *= 100.0; <span class="comment">// multiplies the norm of v by 100</span></div>
<div class="line">  v.factorise_norm(); <span class="comment">// rewrites v as |v| * v&#39; where v&#39; has norm 1.</span></div>
<div class="line">}</div>
</div><!-- fragment --><p>Vectors can be iterated over with </p><div class="fragment"><div class="line"><span class="keywordflow">for</span> (<span class="keyword">auto</span> it = v.begin(); it != v.end(); it++) { <span class="comment">/* do stuff */</span> }</div>
</div><!-- fragment --><p> The library also provides a draining iterator, which empties the vector as it goes:</p>
<div class="fragment"><div class="line"><span class="keywordtype">void</span> IsingState::r_matrix(IsingState&amp; tmp, <span class="keywordtype">int</span> i) {</div>
<div class="line"><span class="keywordflow">for</span> (<span class="keyword">auto</span> it = draining_begin (); it != draining_end (); it++)</div>
<div class="line">  IsingPM (*it).r_matrix (tmp, i);</div>
<div class="line"><span class="comment">// here tmp = R_i * v</span></div>
<div class="line"> swap (tmp); <span class="comment">// pull the result back in v.</span></div>
<div class="line">}</div>
</div><!-- fragment --><p>The code above iterates over the state, applies the \(R\)-matrix to each of its components, storing the result in a vector <code>tmp</code>. Then we do a swap to bring back the result to the current vector.</p>
<h1><a class="anchor" id="autotoc_md7"></a>
Transfer matrix</h1>
<h2><a class="anchor" id="autotoc_md8"></a>
Multiplication</h2>
<p>Once the \(R\)-matrices are defined, the transfer matrix is easy to define:</p>
<div class="fragment"><div class="line"><span class="keywordtype">void</span> IsingState::transfer(IsingState&amp; tmp) {</div>
<div class="line"><span class="keywordflow">for</span> (<span class="keywordtype">int</span> pos = 0; pos &lt; SIZE; pos++)</div>
<div class="line">    r_matrix(tmp, 2*pos);</div>
<div class="line"><span class="keywordflow">for</span> (<span class="keywordtype">int</span> pos = 0; pos &lt; SIZE; pos++)</div>
<div class="line">    r_matrix(tmp, 2*pos+1);</div>
<div class="line">}</div>
</div><!-- fragment --><p>Now to multiply a state by the transfer matrix we just need to call <code>transfer</code> and feed a vector for storing the intermediate results:</p>
<div class="fragment"><div class="line"><span class="keywordtype">void</span> test_multiplication () {</div>
<div class="line">  IsingState v, tmp;</div>
<div class="line">  v += IsingPM({1, 0, 1}, 2.0); <span class="comment">// v = 2 * |+-+&gt;</span></div>
<div class="line">  v.transfer(tmp); <span class="comment">// v -&gt; T*v</span></div>
<div class="line">}</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md9"></a>
Display</h2>
<p>For debugging purposes, it is convenient to be able to visualise coefficients of the matrix, not only to define the multiplication function. For this, the library provides a class <a class="el" href="class_matrix.html">Matrix</a>. To construct a <code><a class="el" href="class_matrix.html">Matrix</a></code> object, one needs to give two vectors, the first initialised. The program will print the coefficients of the matrix in the space generated by repeated action of the matrix on the initial vector. For instance, in our Ising example:</p>
<div class="fragment"><div class="line">  IsingPM ini({1, 0, 1}, 1);</div>
<div class="line"> </div>
<div class="line">  IsingState s(ini), tmp;</div>
<div class="line"> </div>
<div class="line">  <a class="code hl_class" href="class_matrix.html">Matrix</a> T(&amp;s, &amp;tmp, &amp;IsingState::transfer);</div>
<div class="line">  T.print();</div>
<div class="line">  <span class="comment">/* outputs</span></div>
<div class="line"><span class="comment">  Matrix of dimension 8:</span></div>
<div class="line"><span class="comment">  [</span></div>
<div class="line"><span class="comment">      14.0711   1         1         0.414214  1         0.414214  0.414214  1         ;</span></div>
<div class="line"><span class="comment">      5.82843   2.41421   0.414214  1         0.414214  1         0.171573  2.41421   ;</span></div>
<div class="line"><span class="comment">      5.82843   0.414214  2.41421   1         0.414214  0.171573  1         2.41421   ;</span></div>
<div class="line"><span class="comment">      2.41421   1         1         2.41421   0.171573  0.414214  0.414214  5.82843   ;</span></div>
<div class="line"><span class="comment">      5.82843   0.414214  0.414214  0.171573  2.41421   1         1         2.41421   ;</span></div>
<div class="line"><span class="comment">      2.41421   1         0.171573  0.414214  1         2.41421   0.414214  5.82843   ;</span></div>
<div class="line"><span class="comment">      2.41421   0.171573  1         0.414214  1         0.414214  2.41421   5.82843   ;</span></div>
<div class="line"><span class="comment">      1         0.414214  0.414214  1         0.414214  1         1         14.0711   </span></div>
<div class="line"><span class="comment">  ]</span></div>
<div class="line"><span class="comment">*/</span></div>
</div><!-- fragment --><p>The class also lets us print the basis:</p>
<div class="fragment"><div class="line">  T.print_state_table();</div>
<div class="line">  <span class="comment">/* outputs:</span></div>
<div class="line"><span class="comment">      0  :  (1  1  1    )</span></div>
<div class="line"><span class="comment">      1  :  (1  1  0    )</span></div>
<div class="line"><span class="comment">      2  :  (1  0  1    )</span></div>
<div class="line"><span class="comment">      3  :  (1  0  0    )</span></div>
<div class="line"><span class="comment">      4  :  (0  1  1    )</span></div>
<div class="line"><span class="comment">      5  :  (0  1  0    )</span></div>
<div class="line"><span class="comment">      6  :  (0  0  1    )</span></div>
<div class="line"><span class="comment">      7  :  (0  0  0    )</span></div>
<div class="line"><span class="comment">  */</span></div>
</div><!-- fragment --> </div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.12.0 </li>
  </ul>
</div>
</body>
</html>
