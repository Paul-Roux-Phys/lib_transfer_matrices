<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.12.0"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Transfer Matrices: Usage</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="clipboard.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  extensions: ["tex2jax.js"],
  jax: ["input/TeX","output/HTML-CSS"],
});
</script>
<script type="text/javascript" async="async" src="https://cdn.jsdelivr.net/npm/mathjax@2/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="doxygen-awesome.css" rel="stylesheet" type="text/css"/>
<link href="doxygen-awesome-sidebar-only.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">Transfer Matrices<span id="projectnumber">&#160;0.0.0DEV</span>
   </div>
   <div id="projectbrief">C++ library for transfer matrix computations</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.12.0 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() { codefold.init(0); });
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search',true);
  $(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function(){initNavTree('usage.html',''); initResizable(true); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">Usage</div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="md_src_2usage"></a></p>
<p>The library provides some convenient template classes to cover common needs in transfer matrix computations. This page describes, thanks to an example, how the library is intended to be used.</p>
<h1><a class="anchor" id="autotoc_md3"></a>
Data types</h1>
<h2><a class="anchor" id="autotoc_md4"></a>
Built-in key types</h2>
<p>The library provides a few common key types. It is a good practice to define your own key type inheriting from these:</p>
<div class="fragment"><div class="line"><span class="preprocessor">#define bits_per_site 3</span></div>
<div class="line"><span class="keyword">class </span>Key : <span class="keyword">public</span> <a class="code hl_class" href="classkey__64__bit__t.html">key_64_bit_t</a>&lt;bits_per_site&gt; {</div>
<div class="line">   <span class="keyword">public</span>:</div>
<div class="line">    <span class="keyword">using </span><a class="code hl_class" href="classkey__64__bit__t.html">key_64_bit_t</a>&lt;bits_per_site&gt;<a class="code hl_class" href="classkey__64__bit__t.html">::key_64_bit_t</a>;</div>
<div class="line">    <span class="comment">// we must specify how our keys should be printed</span></div>
<div class="line">    <span class="keywordtype">void</span> print ()<span class="keyword"> const </span>{ <a class="code hl_class" href="classkey__64__bit__t.html">key_64_bit_t&lt;bits_per_site&gt;::print</a> (SIZE); }</div>
<div class="line">    <span class="keywordtype">void</span> shift_right () {</div>
<div class="line">      <span class="keywordtype">int</span> last = (*this)[SIZE-1];</div>
<div class="line">        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = SIZE-2; i &gt;= 0; i--) {</div>
<div class="line">      set (i + 1, (*<span class="keyword">this</span>)[i]);</div>
<div class="line">        }</div>
<div class="line">        set (0, last);</div>
<div class="line">    }</div>
<div class="line">};</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md5"></a>
Basis Vectors</h2>
<p>The class <a class="el" href="class_basis_vector.html">BasisVector&lt;K, V&gt;</a> holds a <code>(key, value)</code> pair of arbitrary types.</p>
<p>A good practice is to derive from this class in order to define a particular basis of a space of states:</p>
<div class="fragment"><div class="line"><span class="keyword">using </span>BV = <a class="code hl_class" href="class_basis_vector.html">BasisVector&lt;bool *, double&gt;</a>;</div>
<div class="line"><span class="keyword">class </span>IsingPM : <span class="keyword">public</span> BV {</div>
<div class="line"><span class="keyword">private</span>:</div>
<div class="line">    <span class="keyword">using </span>BV::BV;</div>
<div class="line">};</div>
<div class="ttc" id="aclass_basis_vector_html"><div class="ttname"><a href="class_basis_vector.html">BasisVector</a></div><div class="ttdef"><b>Definition</b> <a href="_basis_vector_8hpp_source.html#l00005">BasisVector.hpp:5</a></div></div>
</div><!-- fragment --><p>In this example, we create a class <code>IsingPM</code> which holds <code>(key, value)</code> pairs, with</p>
<ul>
<li>keys of type <code>char *</code>, (C-style strings): sequences of 0s and 1s.</li>
<li>values of type <code>double</code>.</li>
</ul>
<p>The last <code>using</code> statement lets <code>IsingPM</code> inherit from the <code><a class="el" href="class_basis_vector.html">BasisVector</a></code> constructor.</p>
<p>Inheriting gives us some flexibility to integrate more data into the <a class="el" href="class_basis_vector.html">BasisVector</a> if we want, e.g. we could add</p>
<div class="fragment"><div class="line"><span class="keyword">class </span>IsingPM : <span class="keyword">public</span> BV {</div>
<div class="line"><span class="comment">// ...</span></div>
<div class="line"><span class="keyword">private</span>:</div>
<div class="line">    uint nb_domain_walls;</div>
<div class="line">}</div>
</div><!-- fragment --><p>to store some more information about the state, in this case the number of Ising domain walls. Or we could define additional methods on the state:</p>
<div class="fragment"><div class="line"><span class="keyword">public</span>:</div>
<div class="line">    <span class="keywordtype">int</span> nb_domain_walls() {</div>
<div class="line">        <span class="keywordtype">int</span> res = 0;</div>
<div class="line">        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; <span class="keyword">sizeof</span>(*this) - 1; i++)</div>
<div class="line">            <span class="keywordflow">if</span> ((*<span class="keyword">this</span>)[i] != (*<span class="keyword">this</span>)[i+1])</div>
<div class="line">                res += 1;</div>
<div class="line">        <span class="keywordflow">return</span> res;</div>
<div class="line">    }</div>
</div><!-- fragment --><p>For the complete documentation of this class click <a class="el" href="class_basis_vector.html">here</a>.</p>
<h2><a class="anchor" id="autotoc_md6"></a>
Vectors</h2>
<p>To represent a general vector, which is a linear combination of basis vectors, the library exposes a class <a class="el" href="class_vector.html">Vector&lt;BasisVector&gt;</a> which stores several <code>(key, value)</code> pairs in a hash table (or dictionary), using the hash table implementation of the C++ standard library <code>std::unordered_map</code>. This data structure allows for fast insertion, lookup, and deletion.</p>
<p>Like for <code><a class="el" href="class_basis_vector.html">BasisVector</a></code>s, it is a good practice to inherit from the <code><a class="el" href="class_vector.html">Vector</a></code> class:</p>
<div class="fragment"><div class="line"><span class="keyword">class </span>IsingState : <span class="keyword">public</span> <a class="code hl_class" href="class_vector.html">Vector</a>&lt;BasisVector&gt; {</div>
<div class="line"><span class="keyword">public</span>:</div>
<div class="line">    <span class="keyword">using </span><a class="code hl_class" href="class_vector.html">Vector</a>&lt;<a class="code hl_class" href="class_basis_vector.html">BasisVector</a>&gt;<a class="code hl_class" href="class_vector.html">::Vector&lt;BasisVector&gt;</a>;</div>
<div class="line">};</div>
<div class="ttc" id="aclass_vector_html"><div class="ttname"><a href="class_vector.html">Vector</a></div><div class="ttdef"><b>Definition</b> <a href="_vector_8hpp_source.html#l00016">Vector.hpp:16</a></div></div>
</div><!-- fragment --><p>This again gives some flexibility to add methods and data to the state.</p>
<p>One can multiply a vector by a scalar, add a basis vector to a vector, or add vectors together. Vectors can be looped through, or looped through and drained at the same time, which is useful to limit memory usage. To prevent overflowing of vector components, one can factorize the norm of the vector:</p>
<div class="fragment"><div class="line">IsingState v = IsingState(10); # initialises a vector with a hash table with 10 slots</div>
<div class="line">v *= 100.0;</div>
<div class="line">v.factorise_norm();</div>
</div><!-- fragment --><p>The norm of the vector is stored as an arbitrary precision number, which cannot overflow.</p>
<p>One can easily iterate over all components of a vector <code>v</code>: iterate over the vector and cast the iterator to a <code><a class="el" href="class_basis_vector.html">BasisVector</a></code>, in our example of type <code>IsingPM</code>. The iterator has the type <code>std::pair&lt;Key, Value&gt;</code>, so it needs to be cast to a <code><a class="el" href="class_basis_vector.html">BasisVector</a></code> before using it:</p>
<div class="fragment"><div class="line"><span class="keywordflow">for</span>(<span class="keyword">auto</span> it = v.begin(); it = v.end(); it++) {</div>
<div class="line">    IsingPM p(*it);</div>
<div class="line">    printf(<span class="stringliteral">&quot;key = &quot;</span>); p.print(); printf(<span class="stringliteral">&quot;\n&quot;</span>);</div>
<div class="line">}</div>
</div><!-- fragment --><p>For the complete documentation of this class click <a class="el" href="class_vector.html">here</a>. Alternatively it is possible to use a draining iterator, i.e. one that empties the vector as it goes:</p>
<div class="fragment"><div class="line"><span class="keywordflow">for</span>(<span class="keyword">auto</span> it = v.draining_begin(); it = v.draining_end(); it++) {</div>
<div class="line">    IsingPM p(*it);</div>
<div class="line">    printf(<span class="stringliteral">&quot;key = &quot;</span>); p.print(); printf(<span class="stringliteral">&quot;\n&quot;</span>);</div>
<div class="line">}</div>
<div class="line"><span class="comment">// at this point v is empty</span></div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md7"></a>
R-matrices</h1>
<p>To define the action of a \(R\)-matrix on a state, it is advisable to do as in the following example:</p>
<ul>
<li>Create a method for multiplying a basis state by a \(R\)-matrix, storing the result in some pre-allocated vector:</li>
</ul>
<div class="fragment"><div class="line"><span class="keyword">class </span>IsingPM : <span class="comment">// ...</span></div>
<div class="line">{</div>
<div class="line"><span class="comment">// ...</span></div>
<div class="line"><span class="keyword">public</span>:</div>
<div class="line">    <span class="keywordtype">void</span> add_vertical_edge(IsingState&amp; v, <span class="keywordtype">int</span> pos) {</div>
<div class="line">        BV b2 = *<span class="keyword">this</span>; <span class="comment">// make a copy</span></div>
<div class="line">        value *= expJ;</div>
<div class="line">        b2.key[pos] *= -1;</div>
<div class="line">        b2.value *= expmJ;</div>
<div class="line">        v += *<span class="keyword">this</span>;</div>
<div class="line">        v += b2;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">void</span> add_horizontal_edge(IsingState&amp; v, <span class="keywordtype">int</span> pos1, <span class="keywordtype">int</span> pos2) {</div>
<div class="line">        <span class="keywordflow">if</span> (key[pos1] == key[pos2])</div>
<div class="line">            value *= expJ;</div>
<div class="line">        <span class="keywordflow">else</span> </div>
<div class="line">            value *= expmJ;</div>
<div class="line">        v += *<span class="keyword">this</span>;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// multiply by R_i</span></div>
<div class="line">    <span class="keywordtype">void</span> r_matrix(IsingState&amp; v, <span class="keywordtype">int</span> i) { </div>
<div class="line">        <span class="keywordflow">if</span> (pos%2 == 0)</div>
<div class="line">            add_vertical_edge(v, pos/2);</div>
<div class="line">        <span class="keywordflow">else</span></div>
<div class="line">            add_horizontal_edge(v, pos/2, (pos/2+1)%size);</div>
<div class="line">    }</div>
<div class="line">}</div>
</div><!-- fragment --><ul>
<li>Create a method that acts on a vector and applies the \(R\)-matrix to each of its components:</li>
</ul>
<div class="fragment"><div class="line"><span class="keyword">class </span>IsingState : <span class="comment">// ... </span></div>
<div class="line">{</div>
<div class="line"><span class="keyword">public</span>:</div>
<div class="line">    <span class="keywordtype">void</span> r_matrix(IsingState&amp; v, <span class="keywordtype">int</span> i) {</div>
<div class="line">        <span class="keywordflow">for</span> (<span class="keyword">auto</span> it = draining_begin(); it = draining_end(); it++) {</div>
<div class="line">            IsingPMState(*it).r_matrix(v, i);</div>
<div class="line">        }</div>
<div class="line">        swap (v); <span class="comment">// put the result back in *this (no copying)</span></div>
<div class="line">    }</div>
<div class="line">}</div>
</div><!-- fragment --><p>If several \(R\)-matrices need to be defined, this can be wrapped in a small macro:</p>
<div class="fragment"><div class="line"><span class="preprocessor">#define APPLY_TO_EACH(METHOD)                                      \</span></div>
<div class="line"><span class="preprocessor">    for (auto it = draining_begin (); it != draining_end (); it++) \</span></div>
<div class="line"><span class="preprocessor">        LinkPattern (*it).METHOD</span></div>
</div><!-- fragment --><p>and then</p>
<div class="fragment"><div class="line"><span class="keywordtype">void</span> r_matrix(IsingState&amp; v, <span class="keywordtype">int</span> i) {</div>
<div class="line">    APPLY_TO_EACH (r_matrix) (v, i);</div>
</div><!-- fragment --><p>Now <code>v.r_matrix(2)</code> will multiply v by \(R_2\).</p>
<h1><a class="anchor" id="autotoc_md8"></a>
Transfer matrix</h1>
<p>Once the \(R\)-matrices are defined, it is easy to define a transfer matrix: it requires to have two vectors, an input and an output. Below we define the matrix</p>
<p>$$T=\prod_{i=0}^{\frac{L}{2}} R_{2i} \prod_{i=0}^{\frac{L}{2}} R_{2i+1}$$</p>
<div class="fragment"><div class="line"><span class="keyword">const</span> <span class="keywordtype">int</span> L = 8; <span class="comment">// lattice of width 8</span></div>
<div class="line"><span class="keyword">class </span>IsingState : <span class="comment">// ...</span></div>
<div class="line">{</div>
<div class="line"><span class="comment">// ...</span></div>
<div class="line"><span class="keyword">public</span>:</div>
<div class="line">    <span class="keywordtype">void</span> transfer(IsingState&amp; other) {</div>
<div class="line">        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; L/2; i++)</div>
<div class="line">            r_matrix(other, 2*i);</div>
<div class="line">        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; L/2; i++)</div>
<div class="line">            r_matrix(other, 2*i+1);</div>
<div class="line">    }</div>
<div class="line">}</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md9"></a>
Diagonalisation</h1>
<p>TODO </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.12.0 </li>
  </ul>
</div>
</body>
</html>
